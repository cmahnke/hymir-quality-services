<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupId>de.christianmahnke.lab.iiif.hymir</groupId>
    <artifactId>hymir-quality-services</artifactId>
    <packaging>jar</packaging>
    <version>1.0-SNAPSHOT</version>
    <name>Hymir Plugins to generate different IIIF qualities</name>

    <!--
    <prerequisites>
        <maven>3.4</maven>
    </prerequisites>
    -->

    <properties>
        <maven.compiler.source>11</maven.compiler.source>
        <maven.compiler.target>11</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>

        <groovy.version>3.0.9</groovy.version>
        <opencv.version>4.5.1-2</opencv.version>
        <junit.version>5.8.2</junit.version>
        <guava.version>31.0.1-jre</guava.version>
        <logback.version>1.0.13</logback.version>
        <imgscalr.version>4.2</imgscalr.version>
        <jansi.version>2.4.0</jansi.version>
        <download.verbose>false</download.verbose>
    </properties>

    <developers>
        <developer>
            <name>Christian Mahnke</name>
            <email>cmahnke@gmail.com</email>
            <id>cmahnke</id>
        </developer>
    </developers>
    <url>https://github.com/cmahnke/hymir-quality-services</url>
    <licenses>
        <license>
            <name>MIT License</name>
            <url>https://github.com/cmahnke/hymir-quality-services/blob/main/LICENSE</url>
            <distribution>repo</distribution>
        </license>
    </licenses>
    <distributionManagement>
        <repository>
            <id>github</id>
            <name>GitHub cmahnke Apache Maven Packages</name>
            <url>https://maven.pkg.github.com/cmahnke/hymir-quality-services</url>
        </repository>
        <snapshotRepository>
            <id>github</id>
            <name>GitHub cmahnke Apache Maven Packages</name>
            <url>https://maven.pkg.github.com/cmahnke/hymir-quality-services</url>
        </snapshotRepository>
    </distributionManagement>
    <issueManagement>
        <url>https://github.com/cmahnke/hymir-quality-services/issues</url>
        <system>GitHub Issues</system>
    </issueManagement>
    <scm>
        <connection>https://github.com/cmahnke/hymir-quality-services.git</connection>
        <developerConnection>git@github.com/cmahnke/hymir-quality-services.git</developerConnection>
        <url>https://github.com/cmahnke/hymir-quality-services</url>
    </scm>
    <!-- TODO: This needs authentication, solve this by providing a settings.xml file
    <repositories>
        <repository>
            <id>github</id>
            <url>https://maven.pkg.github.com/cmahnke/hymir-quality-services</url>
            <snapshots>
                <enabled>true</enabled>
            </snapshots>
        </repository>
        <repository>
            <id>central</id>
            <url>https://repo1.maven.org/maven2</url>
        </repository>
    </repositories>
    -->

    <dependencies>
        <dependency>
            <groupId>org.codehaus.groovy</groupId>
            <artifactId>groovy-all</artifactId>
            <version>${groovy.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>de.digitalcollections</groupId>
            <artifactId>iiif-server-hymir</artifactId>
            <version>5.1.2-SNAPSHOT</version>
        </dependency>
        <dependency>
            <groupId>org.openpnp</groupId>
            <artifactId>opencv</artifactId>
            <version>${opencv.version}</version>
        </dependency>
        <dependency>
            <groupId>com.pushtorefresh</groupId>
            <artifactId>javac-warning-annotation</artifactId>
            <version>1.0.0</version>
        </dependency>
        <dependency>
            <groupId>com.google.guava</groupId>
            <artifactId>guava</artifactId>
            <version>${guava.version}</version>
        </dependency>
        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-classic</artifactId>
            <version>${logback.version}</version>
        </dependency>
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-api</artifactId>
            <version>${junit.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-engine</artifactId>
            <version>${junit.version}</version>
            <scope>test</scope>
        </dependency>
        <!-- The following two dependencies are only needed for testing -->
        <dependency>
            <groupId>org.imgscalr</groupId>
            <artifactId>imgscalr-lib</artifactId>
            <version>${imgscalr.version}</version>
        </dependency>
        <dependency>
            <groupId>org.fusesource.jansi</groupId>
            <artifactId>jansi</artifactId>
            <version>${jansi.version}</version>
        </dependency>
        <!-- TODO use this to extract values from LIDO -->
        <dependency>
            <groupId>net.sf.saxon</groupId>
            <artifactId>Saxon-HE</artifactId>
            <version>10.6</version>
        </dependency>
        <!-- TODO: Use this to generate Mapper objects for URL fixing
        <dependency>
            <groupId>org.ow2.asm</groupId>
            <artifactId>asm</artifactId>
            <version>9.2</version>
        </dependency>
        -->
        <dependency>
            <!-- used for this: https://github.com/ihmcrobotics/ihmc-open-robotics-software/blob/09287cf6c061f60f73dd699aad356eedaa0830aa/ihmc-perception/src/main/java/us/ihmc/ihmcPerception/OpenCVTools.java -->
            <groupId>us.ihmc</groupId>
            <artifactId>ihmc-perception</artifactId>
            <version>0.13.0-210804-2</version>
            <exclusions>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>ihmc-perception-javacv</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>ihmc-native-library-loader</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.georegression</groupId>
                    <artifactId>georegression</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.ejml</groupId>
                    <artifactId>ejml-core</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.ejml</groupId>
                    <artifactId>ejml-ddense</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.boofcv</groupId>
                    <artifactId>boofcv-ip</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.boofcv</groupId>
                    <artifactId>boofcv-swing</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.boofcv</groupId>
                    <artifactId>boofcv-io</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.boofcv</groupId>
                    <artifactId>boofcv-recognition</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.boofcv</groupId>
                    <artifactId>boofcv-calibration</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.ddogleg</groupId>
                    <artifactId>ddogleg</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>euclid</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>ihmc-yovariables</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>simulation-construction-set</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>ihmc-jmonkey-engine-toolkit</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>ihmc-graphics-description</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>ihmc-humanoid-robotics</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>ihmc-communication</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>ihmc-ros-tools</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>ihmc-whole-body-controller</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>ihmc-sensor-processing</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>ihmc-robot-models</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>ihmc-java-toolkit</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>us.ihmc</groupId>
                    <artifactId>ihmc-robotics-toolkit</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.apache.commons</groupId>
                    <artifactId>commons-lang3</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>net.java.dev.jna</groupId>
                    <artifactId>jna</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>net.java.dev.jna</groupId>
                    <artifactId>jna</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.boofcv</groupId>
                    <artifactId>boofcv-geo</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
    </dependencies>

    <build>
        <resources>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>false</filtering>
            </resource>
        </resources>
        <testResources>
            <testResource>
                <directory>src/test/resources</directory>
                <filtering>false</filtering>
            </testResource>
        </testResources>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-enforcer-plugin</artifactId>
                <version>3.0.0</version>
                <executions>
                    <execution>
                        <id>enforce-maven</id>
                        <goals>
                            <goal>enforce</goal>
                        </goals>
                        <configuration>
                            <rules>
                                <requireMavenVersion>
                                    <version>3.4</version>
                                </requireMavenVersion>
                            </rules>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.codehaus.gmavenplus</groupId>
                <artifactId>gmavenplus-plugin</artifactId>
                <version>1.13.1</version>
                <executions>
                    <execution>
                        <goals>
                            <goal>addSources</goal>
                            <goal>addTestSources</goal>
                            <goal>compile</goal>
                            <goal>compileTests</goal>
                        </goals>
                    </execution>
                </executions>
                <configuration>
                    <testSources>
                        <testSource>
                            <directory>${project.basedir}/src/test/groovy</directory>
                            <includes>
                                <include>**/*.groovy</include>
                            </includes>
                        </testSource>
                    </testSources>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-antrun-plugin</artifactId>
                <version>3.0.0</version>
                <executions>
                    <execution>
                        <id>download-test-files</id>
                        <phase>process-test-resources</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <target unless="maven.test.skip">
                                <property name="download.dir.images" value="${project.basedir}/src/test/resources/images"/>
                                <property name="download.dir.data" value="${project.basedir}/src/test/resources/data"/>
                                <echo message="Downloading test files to ${download.dir.images}"/>
                                <mkdir dir="${download.dir.images}/record_DE-MUS-062622_kenom_127703"/>
                                <mkdir dir="${download.dir.data}/record_DE-MUS-062622_kenom_127703"/>
                                <get
                                        src="https://sammlungen.uni-goettingen.de/api/v1/records/record_DE-MUS-062622_kenom_127703/files/images/record_DE-MUS-062622_kenom_127703_vs.jpg/full/full/0/default.jpg"
                                        dest="${download.dir.images}/record_DE-MUS-062622_kenom_127703/vs.jpg"
                                        verbose="${download.verbose}"
                                        usetimestamp="true"/>
                                <get
                                        src="https://sammlungen.uni-goettingen.de/api/v1/records/record_DE-MUS-062622_kenom_127703/files/images/record_DE-MUS-062622_kenom_127703_rs.jpg/full/full/0/default.jpg"
                                        dest="${download.dir.images}/record_DE-MUS-062622_kenom_127703/rs.jpg"
                                        verbose="${download.verbose}"
                                        usetimestamp="true"/>
                                <get
                                        src="https://sammlungen.uni-goettingen.de/api/v1/records/record_DE-MUS-062622_kenom_127703/manifest"
                                        dest="${download.dir.data}/record_DE-MUS-062622_kenom_127703/record_DE-MUS-062622_kenom_127703.json"
                                        verbose="${download.verbose}"
                                        usetimestamp="true"/>
                                <get
                                        src="https://sammlungen.uni-goettingen.de/lidoresolver?id=record_DE-MUS-062622_kenom_127703"
                                        dest="${download.dir.data}/record_DE-MUS-062622_kenom_127703/record_DE-MUS-062622_kenom_127703.lido.xml"
                                        verbose="${download.verbose}"
                                        usetimestamp="true"/>
                                <!-- Only the images of DE-611-HS-3461927 -->
                                <mkdir dir="${download.dir.images}/DE-611-HS-3461927"/>
                                <get src="https://images.sub.uni-goettingen.de/iiif/image/gdz:DE-611-HS-3461927:00000001/full/full/0/default.jpg"
                                     dest="${download.dir.images}/DE-611-HS-3461927/00000001.jpg" verbose="${download.verbose}"
                                     usetimestamp="true"/>
                                <get src="https://images.sub.uni-goettingen.de/iiif/image/gdz:DE-611-HS-3461927:00000002/full/full/0/default.jpg"
                                     dest="${download.dir.images}/DE-611-HS-3461927/00000002.jpg" verbose="${download.verbose}"
                                     usetimestamp="true"/>
                                <get src="https://images.sub.uni-goettingen.de/iiif/image/gdz:DE-611-HS-3461927:00000003/full/full/0/default.jpg"
                                     dest="${download.dir.images}/DE-611-HS-3461927/00000003.jpg" verbose="${download.verbose}"
                                     usetimestamp="true"/>
                                <get src="https://images.sub.uni-goettingen.de/iiif/image/gdz:DE-611-HS-3461927:00000004/full/full/0/default.jpg"
                                     dest="${download.dir.images}/DE-611-HS-3461927/00000004.jpg" verbose="${download.verbose}"
                                     usetimestamp="true"/>
                                <get src="https://images.sub.uni-goettingen.de/iiif/image/gdz:DE-611-HS-3461927:00000005/full/full/0/default.jpg"
                                     dest="${download.dir.images}/DE-611-HS-3461927/00000005.jpg" verbose="${download.verbose}"
                                     usetimestamp="true"/>
                                <get src="https://images.sub.uni-goettingen.de/iiif/image/gdz:DE-611-HS-3461927:00000006/full/full/0/default.jpg"
                                     dest="${download.dir.images}/DE-611-HS-3461927/00000006.jpg" verbose="${download.verbose}"
                                     usetimestamp="true"/>
                                <get src="https://images.sub.uni-goettingen.de/iiif/image/gdz:DE-611-HS-3461927:00000007/full/full/0/default.jpg"
                                     dest="${download.dir.images}/DE-611-HS-3461927/00000007.jpg" verbose="${download.verbose}"
                                     usetimestamp="true"/>
                            </target>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-source-plugin</artifactId>
                <version>3.2.1</version>
                <executions>
                    <execution>
                        <id>attach-sources</id>
                        <goals>
                            <goal>jar</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <artifactId>maven-clean-plugin</artifactId>
                <version>3.1.0</version>
                <configuration>
                    <filesets>
                        <fileset>
                            <directory>${basedir}</directory>
                            <includes>
                                <include>**/output*.png</include>
                                <include>src/test/resources/images/**</include>
                                <include>src/test/resources/data/**</include>
                            </includes>
                        </fileset>
                    </filesets>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-shade-plugin</artifactId>
                <version>3.2.4</version>
                <configuration>
                    <minimizeJar>true</minimizeJar>
                    <transformers>
                        <transformer
                                implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"/>
                    </transformers>
                    <filters>
                        <filter>
                            <artifact>us.ihmc:*</artifact>
                            <excludes>
                                <exclude>examples/**</exclude>
                                <exclude>models/**</exclude>
                                <exclude>faceDetection/**</exclude>
                                <exclude>drill_DCS551/**</exclude>
                            </excludes>
                        </filter>
                        <filter>
                            <artifact>*:*</artifact>
                            <excludes>
                                <exclude>META-INF/*.SF</exclude>
                                <exclude>META-INF/*.DSA</exclude>
                                <exclude>META-INF/*.RSA</exclude>
                            </excludes>
                        </filter>
                        <filter>
                            <artifact>net.sf.saxon:Saxon-HE</artifact>
                            <excludes>
                                <exclude>META-INF/services/javax.xml.transform.TransformerFactory</exclude>
                            </excludes>
                        </filter>
                        <filter>
                            <artifact>de.christianmahnke.lab.iiif.hymir:hymir-quality-services</artifact>
                            <excludes>
                                <exclude>application.yml</exclude>
                            </excludes>
                        </filter>
                    </filters>
                    <artifactSet>
                        <includes>
                            <include>org.codehaus.groovy:groovy</include>
                            <include>org.openpnp:opencv</include>
                            <include>com.google.guava:guava</include>
                            <include>us.ihmc:ihmc-perception</include>
                            <include>net.sf.saxon:Saxon-HE</include>
                            <!--
                            <include>ch.qos.logback:logback-classic</include>
                            <include>ch.qos.logback:logback-core</include>
                            <include>org.slf4j:slf4j-api</include>
                            -->
                        </includes>
                    </artifactSet>
                </configuration>
                <executions>
                    <execution>
                        <phase>package</phase>
                        <goals>
                            <goal>shade</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <artifactId>maven-surefire-plugin</artifactId>
                <version>3.0.0-M5</version>
            </plugin>
        </plugins>
    </build>
</project>
